# 자동 인원 파악 시스템 - 기능 명세서

## 시스템 개요

실시간으로 매장 내 인원수를 자동으로 파악하고 혼잡도를 모니터링하는 시스템입니다. ESP32 카메라와 YOLO 기반 AI를 활용하여 정확한 인원 집계를 제공합니다.

---

## 개발 단계

**현재 단계:**
- ✅ **Phase 1**: 하드웨어 구성 (ESP32 + OV2640 카메라)
- ✅ **Phase 2**: 백엔드 서버 (FastAPI + YOLO AI)
- ✅ **Phase 3**: 데이터베이스 구조
- 🔜 **Phase 4**: 웹 대시보드 (추후 개발 예정)

---

## 1. 핵심 기능

### 1.1 자동 인원 감지
- **자동 촬영**: 5초 간격으로 자동 이미지 캡처
- **AI 분석**: YOLOv8 기반 머리 감지 알고리즘
- **정확도**: 95% 이상의 인원 감지 정확도
- **처리 속도**: 실시간 이미지 분석 및 결과 반환

### 1.2 데이터 수집 및 저장
- **자동 기록**: 감지된 인원수를 타임스탬프와 함께 DB 저장
- **매장별 관리**: 여러 매장의 데이터를 구분하여 저장
- **카메라별 추적**: 매장 내 여러 카메라 지원
- **이력 관리**: 시간대별 인원 변화 추적

### 1.3 혼잡도 계산
- **혼잡도 산출**: 현재 인원 / 총 좌석수 비율 계산
- **맞춤형 기준**: 매장별 좌석수 설정 가능
- **변화 감지**: 혼잡도 변동 추이 분석

---

## 2. 하드웨어 기능

### 2.1 카메라 시스템
- **OV2640 CMOS 센서**: 초저가 고효율 카메라
- **JPEG 출력**: 압축된 이미지 전송으로 대역폭 절약
- **유연한 설치**: 천장/벽면 어디든 설치 가능

### 2.2 네트워크 연결
- **LAN 기반 안정성**: Wi-Fi 불안정 환경에서도 안정적 작동
- **PoE 전원 공급**: 단일 LAN 케이블로 데이터 + 전원 동시 공급
- **간편한 배선**: 복잡한 전원 배선 불필요

### 2.3 ESP32 제어
- **WT32-ETH01 보드**: Ethernet 내장으로 안정적 통신
- **자동 전송**: 촬영한 이미지를 자동으로 서버에 전송
- **저전력 운영**: 24시간 연속 작동 가능

---

## 3. 백엔드 기능

### 3.1 API 서버 (FastAPI)
- **이미지 수신**: ESP32에서 전송된 JPEG 이미지 수신
- **RESTful API**: 표준 HTTP API 제공
- **빠른 응답**: 비동기 처리로 고성능 보장
- **확장성**: 다중 카메라 동시 처리 가능

### 3.2 AI 추론 엔진
- **YOLOv8 모델**: 최신 객체 감지 알고리즘
- **머리 감지 특화**: yolov8n-head 모델 사용
- **실시간 처리**: Orange Pi RV2에서 실시간 추론
- **정확한 카운팅**: 중복 없는 정확한 인원수 집계

### 3.3 데이터베이스
- **구조화된 저장**: 매장, 카메라, 시간별 데이터 관리
- **SQLite/PostgreSQL**: 용도에 따라 선택 가능
- **확장 가능**: 추가 메타데이터(heatmap, bbox 등) 저장 가능

### 3.4 API 엔드포인트
```
POST /upload         - 이미지 업로드 및 인원수 반환
GET  /live           - 현재 인원수 조회
GET  /history        - 시간대별 인원수 이력
GET  /occupancy      - 혼잡도 계산
```

---

## 4. 향후 기능 (웹 대시보드)

> **개발 예정**: 백엔드 완성 후 개발 시작

### 4.1 대시보드 모니터링
- **대시보드**: 매장별 최신 인원수 표시
- **수동 갱신**: 새로고침 버튼으로 최신 데이터 조회
- **다중 매장 뷰**: 여러 매장을 한 화면에서 모니터링

### 4.2 시각화
- **차트**: 시간대별 인원 변화 그래프
- **통계**: 일/주/월별 혼잡도 통계
- **알림**: 혼잡도 임계값 초과 시 알림

### 4.3 관리 기능
- **매장 관리**: 매장 등록, 수정, 삭제
- **카메라 설정**: 카메라 ID 매핑 및 설정
- **좌석 관리**: 매장별 좌석수 설정

### 4.4 기술 스택
- **프론트엔드**: React + TypeScript + Vite
- **UI 프레임워크**: Chakra UI
- **데이터 페칭**: TanStack Query - 캐싱 및 상태 관리
- **차트**: Recharts 또는 Chart.js

> **참고**: 자동 폴링/SSE/WebSocket 불필요. 사용자가 필요시 새로고침 버튼으로 최신 데이터 조회.

---

## 5. 시스템 장점

### 5.1 설치 및 운영
- **간편한 설치**: LAN 케이블 하나로 전원 + 데이터 해결
- **낮은 비용**: 저렴한 하드웨어로 고성능 시스템 구현
- **무인 운영**: 설치 후 자동 작동, 관리 불필요
- **유지비 0원**: 추가 비용 없이 지속 운영

### 5.2 성능 및 확장성
- **높은 정확도**: 95% 이상의 인원 감지 정확도
- **안정적 처리**: 5초 간격 데이터 수집
- **확장 용이**: 1개 매장부터 100개 매장까지 동일한 구조
- **안정성**: LAN 기반으로 Wi-Fi보다 안정적

### 5.3 활용 가치
- **혼잡도 파악**: 매장 혼잡도 확인
- **운영 최적화**: 인원 데이터 기반 매장 운영 개선
- **고객 경험**: 혼잡도 정보 제공으로 고객 만족도 향상
- **데이터 분석**: 시간대별 방문 패턴 분석

---

## 6. 기술적 특징

### 6.1 엣지 컴퓨팅
- **분산 처리**: ESP32에서 이미지 캡처, 서버에서 AI 추론
- **대역폭 최적화**: JPEG 압축으로 네트워크 효율 향상
- **중앙 집중식 AI**: Orange Pi에서 통합 분석

### 6.2 확장 가능한 아키텍처
- **모듈형 설계**: 하드웨어, 백엔드, 프론트엔드 독립적 개발
- **API 기반**: 다양한 클라이언트 지원 가능
- **멀티 카메라**: 매장당 여러 카메라 설치 가능

### 6.3 오픈 스탠다드
- **표준 프로토콜**: HTTP/REST API
- **범용 하드웨어**: ESP32, Orange Pi 등 오픈 하드웨어
- **오픈소스 AI**: YOLO 오픈소스 모델 활용

---

## 7. 사용 시나리오

### 시나리오 1: 카페/레스토랑
- 대시보드에서 현재 혼잡도 확인
- 필요시 고객에게 혼잡도 정보 안내
- 피크 시간대 인력 배치 최적화

### 시나리오 2: 다중 매장 체인
- 본사에서 여러 매장 혼잡도 통합 모니터링
- 매장별 방문 패턴 분석
- 데이터 기반 운영 전략 수립

### 시나리오 3: 공공 시설
- 시설 이용 현황 파악
- 혼잡 시간대 분산 유도
- 안전 인원 관리

---

## 8. 로드맵

### 현재 (Phase 1-3)
- ✅ 하드웨어 구성 및 배선
- ✅ ESP32 펌웨어 개발
- ✅ FastAPI 백엔드 서버
- ✅ YOLO AI 추론 엔진
- ✅ 데이터베이스 설계

### 다음 단계 (Phase 4)
- 🔜 웹 대시보드 개발
- 🔜 모니터링 UI
- 🔜 차트 및 통계 기능
- 🔜 알림 시스템

### 향후 계획
- 📅 모바일 앱 (선택)
- 📅 히트맵 시각화
- 📅 예측 기능 (ML 기반)
- 📅 다중 카메라 통합 뷰